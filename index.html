<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Split Bill</title>
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <style>
        /* Custom styles for number input on mobile */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield; /* Firefox */
        }
        /* Style for table headers */
        .table-header-cell {
            @apply px-4 py-2 text-xs font-medium text-gray-500 uppercase tracking-wider;
        }
        /* Style for table data cells */
        .table-data-cell {
            @apply px-4 py-2 whitespace-nowrap;
        }
    </style>
    <script src="cdn.tailwindcss.com/3.4.17/main.js"></script>
</head>
<body class="bg-gray-100 px-2 md:px-8 lg:px-20 py-4 font-sans">

    <header class="fixed top-0 left-0 right-0 z-10 bg-white shadow-lg p-4">
        <div class="max-w-xl mx-auto">
            <div class="flex flex-row gap-2 items-center justify-center">
                <svg version="1.1" id="_x35_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" width="24px" height="24px" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <linearGradient id="SVGID_1_" gradientUnits="userSpaceOnUse" x1="250.6101" y1="128.0113" x2="501.2197" y2="128.0113"> <stop offset="0.0918" style="stop-color:#B0ACAA"></stop> <stop offset="1" style="stop-color:#ACACAB"></stop> </linearGradient> <path style="fill:url(#SVGID_1_);" d="M501.22,41.433v214.59H250.61V0h209.178c5.088,0,10.015,0.889,14.537,2.666 c11.226,4.2,20.11,13.085,24.229,24.229C500.251,31.418,501.22,36.344,501.22,41.433z"></path> <linearGradient id="SVGID_2_" gradientUnits="userSpaceOnUse" x1="0" y1="128.0113" x2="250.6101" y2="128.0113"> <stop offset="0.0918" style="stop-color:#B0ACAA"></stop> <stop offset="1" style="stop-color:#ACACAB"></stop> </linearGradient> <path style="fill:url(#SVGID_2_);" d="M250.61,0v256.023H0V41.433C0,18.576,18.576,0,41.432,0H250.61z"></path> <linearGradient id="SVGID_3_" gradientUnits="userSpaceOnUse" x1="-0.0365" y1="384.0052" x2="501.2233" y2="384.0052"> <stop offset="0.0338" style="stop-color:#EE7945"></stop> <stop offset="1" style="stop-color:#ff0000"></stop> </linearGradient> <path style="fill:url(#SVGID_3_);" d="M501.223,256.01v214.57c0,22.903-18.55,41.42-41.42,41.42h-209.21V256.01H501.223z"></path> <linearGradient id="SVGID_4_" gradientUnits="userSpaceOnUse" x1="0" y1="383.9925" x2="250.6101" y2="383.9925"> <stop offset="0.0918" style="stop-color:#B0ACAA"></stop> <stop offset="1" style="stop-color:#ACACAB"></stop> </linearGradient> <path style="fill:url(#SVGID_4_);" d="M250.61,256.023v255.94H41.432c-5.734,0-11.145-1.132-16.072-3.23 c-10.015-4.2-18.01-12.276-22.21-22.21C1.131,481.595,0,476.266,0,470.61V256.023H250.61z"></path> <polygon style="fill:#FFFFFF;" points="136.154,117.862 136.154,86.02 114.461,86.02 114.461,117.862 81.889,117.862 81.889,137.94 114.461,137.94 114.461,170.045 136.154,170.045 136.154,137.94 168.729,137.94 168.729,117.862 "></polygon> <rect x="343.027" y="117.17" style="fill:#FFFFFF;" width="65.765" height="21.722"></rect> <polygon style="fill:#FFFFFF;" points="164.069,359.53 150.69,346.624 125.307,371.116 99.928,346.624 86.549,359.53 111.929,384.021 86.549,408.506 99.928,421.418 125.307,396.927 150.69,421.418 164.069,408.506 138.686,384.021 "></polygon> <linearGradient id="SVGID_5_" gradientUnits="userSpaceOnUse" x1="338.6428" y1="384.032" x2="413.1875" y2="384.032"> <stop offset="0.0338" style="stop-color:#FFFFFF"></stop> <stop offset="1" style="stop-color:#ff0000"></stop> </linearGradient> <path style="opacity:0.4;fill:url(#SVGID_5_);" d="M338.643,394.289v14.053h74.545v-14.053H338.643z M338.643,359.722v14.053 h74.545v-14.053H338.643z"></path> <rect x="247.379" style="fill:#E9E8E8;" width="6.461" height="511.962"></rect> <rect y="252.791" style="fill:#E9E8E8;" width="501.22" height="6.462"></rect> <path style="fill:#FFFFFF;" d="M336.704,393.078v13.972h74.626v-13.972H336.704z M336.704,358.511v14.053h74.626v-14.053H336.704z"></path> <polygon style="fill:#F2F2F2;" points="134.259,116.643 134.259,84.801 112.566,84.801 112.566,116.643 79.994,116.643 79.994,136.722 112.566,136.722 112.566,168.827 134.259,168.827 134.259,136.722 166.834,136.722 166.834,116.643 "></polygon> <rect x="341.132" y="115.952" style="fill:#F2F2F2;" width="65.765" height="21.722"></rect> <polygon style="fill:#F2F2F2;" points="162.174,358.312 148.795,345.406 123.412,369.898 98.033,345.406 84.655,358.312 110.034,382.803 84.655,407.288 98.033,420.2 123.412,395.709 148.795,420.2 162.174,407.288 136.791,382.803 "></polygon> </g> </g></svg>
                <h1 class="text-xl font-bold text-center text-gray-800">
                    Kalkulator <span class="underline text-red-600">SplitBILL</span>
                </h1>
            </div>
        </div>
    </header>

    <div class="mx-auto bg-transparent md:bg-white rounded-xl shadow-none overflow-hidden p-4">
        <div class="mt-14 md:mt-12"></div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="">
                <div class="mb-2 p-4 bg-white border border-gray-200">
                    <div class="flex flex-row gap-2 mb-2">
                        <div class="px-1 py-2 bg-green-600"></div>
                        <h2 class="font-bold text-gray-800">Ringkasan Total</h2>
                    </div>
                    <hr>
                    <div class="flex justify-between items-center my-1 px-2">
                        <span class="text-sm font-medium text-gray-600">Harga Aplikasi Dasar:</span>
                        <span id="total-harga-aplikasi" class="font-bold text-gray-800">Rp 0</span>
                    </div>
                    <div class="flex justify-between items-center mb-1 px-2">
                        <span class="text-sm font-medium text-gray-600">Total Biaya Penambah:</span>
                        <span id="total-biaya-lain" class="font-bold text-gray-800">Rp 0</span>
                    </div>
                    <div class="flex justify-between items-center p-2 border-t border-green-300 bg-green-50 mt-2">
                        <span class="text-sm font-semibold text-gray-700">TOTAL HARGA FINAL:</span>
                        <span id="total-bersih" class="text-xl font-extrabold text-green-600">Rp 0</span>
                    </div>
                </div>

                <div class="border-b border-dashed border-red-300 visible md:invisible"></div>
            </div>

            <div class="">
                <div class="mb-2 bg-white p-2 border border-gray-300">
                    <div class="flex justify-between items-center mb-3 border-b pb-2">
                        <div class="flex flex-row gap-2">
                            <div class="px-1 py-2 bg-yellow-600"></div>
                            <h2 class="font-bold text-gray-800">Biaya Lain & Diskon</h2>
                        </div>
                        <button onclick="addCost()" class="px-3 py-1 bg-yellow-600 text-white text-sm font-medium shadow hover:bg-yellow-700 transition duration-150">
                            +
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 divide-dashed border text-xs">
                            <thead class="bg-yellow-50">
                                <tr>
                                    <th class="table-header-cell text-left p-2">Deskripsi</th>
                                    <th class="table-header-cell text-right py-2">Nominal (Rp)</th>
                                    <th class="table-header-cell text-center w-12 p-2">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="cost-list" class="bg-white divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="flex justify-between items-center p-2 mt-1 bg-red-50 border border-red-300">
                        <span class="text-sm font-medium text-gray-700 w-1/3">Diskon (Rp):</span>
                        <input type="number" id="diskon" value="0" class="w-1/2 text-right px-2 text-base border outline-none focus:border-red-500" oninput="calculateSplit()">
                    </div>
                </div>

                <div class="bg-white p-2 border border-gray-300">
                    <div class="flex justify-between items-center mb-3 border-b pb-2">
                        <div class="flex flex-row gap-2">
                            <div class="px-1 py-2 bg-blue-600"></div>
                            <h2 class="font-bold text-gray-800">Daftar Item</h2>
                        </div>
                        <button onclick="addItem()" class="px-3 py-1 bg-blue-500 text-white text-sm font-medium shadow hover:bg-blue-600 transition duration-150">
                            +
                        </button>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 divide-dashed border-collapse border text-xs">
                            <thead class="bg-blue-50">
                                <tr>
                                    <th class="table-header-cell text-left w-1/3 p-2">Item</th>
                                    <th class="table-header-cell text-right w-1/4 py-2">Awal (Rp)</th>
                                    <th class="table-header-cell text-right w-1/4 py-2">Final (Rp)</th>
                                    <th class="table-header-cell text-center w-12 p-2">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="item-list" class="bg-white divide-y divide-gray-200">
                            </tbody>
                            <tfoot class="bg-white">
                                <tr>
                                    <td class="table-data-cell font-bold text-gray-800 p-2">TOTAL</td>
                                    <td id="table-total-aplikasi" class="table-data-cell font-bold text-right text-gray-800"></td>
                                    <td id="table-total-final" class="table-data-cell font-bold text-right text-green-600"></td>
                                    <td class="table-data-cell"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <p class="text-xs text-center text-gray-400 mt-6">Harga Final mencakup Biaya Lain dan Diskon, dibagi secara proporsional.</p>
    </div>

    <script>
        // Data Awal
        let items = [
            { id: 1, nama: "Item 1", hargaAplikasi: 0 },
        ];
        
        let otherCosts = [
            { id: 101, nama: "Biaya 1", nominal: 0 },
        ];

        let nextItemId = items.length > 0 ? Math.max(...items.map(i => i.id)) + 1 : 1;
        let nextCostId = otherCosts.length > 0 ? Math.max(...otherCosts.map(i => i.id)) + 1 : 101;

        const itemListEl = document.getElementById('item-list');
        const costListEl = document.getElementById('cost-list');
        const diskonEl = document.getElementById('diskon');
        const totalHargaAplikasiEl = document.getElementById('total-harga-aplikasi');
        const totalBiayaLainEl = document.getElementById('total-biaya-lain');
        const totalBersihEl = document.getElementById('total-bersih');
        const tableTotalAplikasiEl = document.getElementById('table-total-aplikasi');
        const tableTotalFinalEl = document.getElementById('table-total-final');

        // Fungsi untuk format angka ke Rupiah
        const formatRupiah = (number) => {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(number);
        };

        // --- LOGIKA PERHITUNGAN UTAMA ---
        function calculateSplit() {
            const diskon = parseFloat(diskonEl.value) || 0;
            
            // 1. Hitung Total Biaya Lain
            const totalBiayaLain = otherCosts.reduce((sum, cost) => sum + (parseFloat(cost.nominal) || 0), 0);

            // 2. Hitung Total Harga Aplikasi
            const totalHargaAplikasi = items.reduce((sum, item) => sum + (parseFloat(item.hargaAplikasi) || 0), 0);

            // 3. Hitung Total Bersih (Total Harga Final)
            const totalBersih = totalHargaAplikasi + totalBiayaLain - diskon;

            // 4. Hitung Faktor Pengali Proporsional
            const faktorPengali = totalHargaAplikasi > 0 ? totalBersih / totalHargaAplikasi : 0;
            
            // 5. Hitung dan Update Harga Final untuk setiap item
            let calculatedTotalFinal = 0;
            items.forEach(item => {
                const hargaFinal = Math.round((parseFloat(item.hargaAplikasi) || 0) * faktorPengali);
                item.hargaFinal = Math.max(0, hargaFinal);
                calculatedTotalFinal += item.hargaFinal;

                // Update UI Item
                const finalCell = document.getElementById(`final-${item.id}`);
                if (finalCell) {
                    finalCell.textContent = formatRupiah(item.hargaFinal);
                }
            });
            
            // 6. Update Rekap Total di UI
            totalHargaAplikasiEl.textContent = formatRupiah(totalHargaAplikasi);
            totalBiayaLainEl.textContent = formatRupiah(totalBiayaLain);
            totalBersihEl.textContent = formatRupiah(Math.max(0, calculatedTotalFinal)); // Gunakan hasil penjumlahan dari tabel untuk akurasi

            // 7. Update Footer Tabel
            tableTotalAplikasiEl.textContent = formatRupiah(totalHargaAplikasi);
            tableTotalFinalEl.textContent = formatRupiah(calculatedTotalFinal);
        }

        // --- FUNGSI DINAMIS BIAYA LAIN (COSTS) ---

        function createCostRow(cost) {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-100 bg-gray-50';
            row.id = `cost-row-${cost.id}`;
            
            row.innerHTML = `
                <td class="table-data-cell text-left">
                    <input type="text" 
                        value="${cost.nama}" 
                        class="w-full text-sm p-1 m-1 border border-transparent outline-none focus:border-gray-300"
                        oninput="updateCostName(${cost.id}, this.value)">
                </td>
                <td class="table-data-cell text-right">
                    <input type="number" 
                        value="${cost.nominal}" 
                        class="w-full text-right p-1 m-1 text-sm border border-transparent outline-none focus:border-gray-300"
                        oninput="updateCostNominal(${cost.id}, this.value)">
                </td>
                <td class="table-data-cell text-center">
                    <button onclick="deleteCost(${cost.id})" class="text-red-500 hover:text-red-700 transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5 0a1 1 0 112 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </td>
            `;
            return row;
        }

        function renderCosts() {
            costListEl.innerHTML = '';
            otherCosts.forEach(cost => {
                costListEl.appendChild(createCostRow(cost));
            });
            calculateSplit();
        }

        function addCost() {
            const newCost = {
                id: nextCostId++,
                nama: `Biaya Tambahan ${nextCostId - 101}`,
                nominal: 0
            };
            otherCosts.push(newCost);
            renderCosts(); 
        }

        function deleteCost(id) {
            if (otherCosts.length > 0) {
                otherCosts = otherCosts.filter(cost => cost.id !== id);
                renderCosts();
            }
        }

        function updateCostNominal(id, newNominalString) {
            const newNominal = parseFloat(newNominalString) || 0;
            const cost = otherCosts.find(cost => cost.id === id);
            
            if (cost) {
                cost.nominal = Math.max(0, newNominal);
                calculateSplit();
            }
        }

        function updateCostName(id, newName) {
            const cost = otherCosts.find(cost => cost.id === id);
            if (cost) {
                cost.nama = newName;
            }
        }
        
        // --- FUNGSI DINAMIS ITEM ---

        function createItemRow(item) {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-100 bg-gray-50';
            row.id = `item-card-${item.id}`;
            
            row.innerHTML = `
                <td class="table-data-cell text-left">
                    <input type="text" 
                        value="${item.nama}" 
                        class="w-full text-sm p-1 m-1 border border-transparent outline-none focus:border-gray-300 font-medium text-gray-700"
                        oninput="updateItemName(${item.id}, this.value)">
                </td>
                <td class="table-data-cell text-right">
                    <input type="number" 
                        value="${item.hargaAplikasi}" 
                        class="w-full text-right p-1 m-1 text-sm border border-transparent outline-none focus:border-gray-300"
                        oninput="updateItemPrice(${item.id}, this.value)">
                </td>
                <td class="table-data-cell text-right font-semibold text-blue-700" id="final-${item.id}">
                    ${formatRupiah(item.hargaFinal || 0)}
                </td>
                <td class="table-data-cell text-center">
                    <button onclick="deleteItem(${item.id})" class="text-red-500 hover:text-red-700 transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5 0a1 1 0 112 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </td>
            `;
            return row;
        }

        function renderItems() {
            itemListEl.innerHTML = '';
            items.forEach(item => {
                itemListEl.appendChild(createItemRow(item));
            });
            calculateSplit();
        }

        function addItem() {
            const newItem = {
                id: nextItemId++,
                nama: `Item Baru ${nextItemId - 1}`,
                hargaAplikasi: 0,
                hargaFinal: 0
            };
            items.push(newItem);
            renderItems();
        }

        function deleteItem(id) {
            if (items.length > 1) {
                items = items.filter(item => item.id !== id);
                renderItems();
            } else {
                alert("Minimal harus ada satu item.");
            }
        }

        function updateItemPrice(id, newPriceString) {
            const newPrice = parseFloat(newPriceString) || 0;
            const item = items.find(item => item.id === id);
            
            if (item) {
                item.hargaAplikasi = Math.max(0, newPrice); 
                calculateSplit(); 
            }
        }

        function updateItemName(id, newName) {
            const item = items.find(item => item.id === id);
            if (item) {
                item.nama = newName;
            }
        }


        // Jalankan saat dokumen selesai dimuat
        document.addEventListener('DOMContentLoaded', () => {
            renderCosts();
            renderItems();
        });
    </script>

    <script type="text/javascript">
        document.addEventListener('contextmenu', function(e) {
            // Mencegah munculnya menu klik kanan
            e.preventDefault(); 
        });

        document.onkeydown = function(e) {
            // F12 key (123)
            if (e.keyCode == 123) {
                e.preventDefault();
                return false;
            }
            // Ctrl+Shift+I (developer tools)
            if (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) {
                e.preventDefault();
                return false;
            }
        };
    </script>
</body>
</html>
